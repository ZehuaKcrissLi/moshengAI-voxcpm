# MoshengAI 服务访问指南

## 🎯 正确的访问地址

### 服务器信息
- **主机名**: sigurd-ubuntu24
- **主IP地址**: `10.212.227.125`

### 前端访问地址
```
http://10.212.227.125:3000
```

### 后端API地址
```
http://10.212.227.125:8000
```

---

## ❌ 常见错误

### 错误访问方式：
```
http://localhost:3000  ❌ 错误！这只能在服务器本机使用
```

**原因**: 
- 服务运行在远程服务器 `10.212.227.125` 上
- 你的浏览器在本地电脑上访问 `localhost:3000`
- `localhost` 指向的是**你的本地电脑**，不是远程服务器
- 所以浏览器请求发出但找不到服务（Response Headers: 0）

---

## ✅ 正确访问步骤

### 方法1: 直接使用IP访问（推荐）

1. 在浏览器地址栏输入：
   ```
   http://10.212.227.125:3000
   ```

2. 如果看到 "Mosheng AI" 界面，说明成功！

### 方法2: 使用端口转发（如果IP无法访问）

如果因为网络限制无法直接访问服务器IP，使用SSH端口转发：

```bash
# 在你的本地电脑运行（不是服务器上）
ssh -L 3000:localhost:3000 -L 8000:localhost:8000 kcriss@10.212.227.125

# 然后在浏览器访问
http://localhost:3000
```

**说明**: 这会将你本地的3000端口转发到服务器的3000端口

---

## 🔧 验证服务状态

### 1. 检查后端API
在浏览器或命令行测试：
```bash
curl http://10.212.227.125:8000/health
# 应该返回: {"status":"ok"}
```

### 2. 检查音色列表
```bash
curl http://10.212.227.125:8000/voices/ | head -20
# 应该返回: 137个音色的JSON数据
```

### 3. 在服务器上验证（管理员用）
```bash
# 检查端口监听
netstat -tlnp | grep -E ':(3000|8000)'

# 检查进程
ps aux | grep -E "(next dev|uvicorn)"

# 本地测试
curl http://localhost:3000 | head -20
curl http://localhost:8000/health
```

---

## 🌐 网络拓扑

```
你的本地电脑 (浏览器)
        |
        | 通过网络访问
        ↓
服务器 10.212.227.125
        |
        ├─ 端口 3000: Next.js 前端
        └─ 端口 8000: FastAPI 后端 + TTS引擎
```

---

## 🐛 故障排查

### 问题: 浏览器显示"无法访问此网站"

**可能原因1**: 防火墙阻止
```bash
# 在服务器上检查防火墙
sudo ufw status
sudo ufw allow 3000
sudo ufw allow 8000
```

**可能原因2**: 网络不通
```bash
# 在本地电脑测试网络连通性
ping 10.212.227.125
telnet 10.212.227.125 3000
```

**可能原因3**: 服务未启动
```bash
# 在服务器上检查
curl http://localhost:3000
# 如果失败，重启服务
cd /scratch/kcriss/MoshengAI/frontend && npm run dev
```

### 问题: 前端打开但API调用失败

检查前端配置是否正确指向后端：
```javascript
// 文件: /scratch/kcriss/MoshengAI/frontend/src/lib/api.ts
// 应该是:
const API_URL = 'http://10.212.227.125:8000';  // 使用服务器IP
// 而不是:
const API_URL = 'http://localhost:8000';  // 这会失败
```

---

## 📱 移动设备访问

如果你的手机和服务器在同一局域网，也可以访问：
```
http://10.212.227.125:3000
```

---

## 🔐 安全建议

**当前配置**: 开发环境，监听 `0.0.0.0:3000` 和 `0.0.0.0:8000`
- ✅ 优点: 可从任何IP访问，方便开发测试
- ⚠️ 风险: 暴露在局域网，任何人都可访问

**生产环境建议**:
1. 使用 Nginx 反向代理
2. 配置 HTTPS (SSL证书)
3. 添加防火墙规则限制访问IP
4. 使用 Cloudflare Tunnel 进行公网访问
5. 添加用户认证

---

## 📊 当前服务状态

| 服务 | 地址 | 状态 | 协议 |
|-----|------|------|------|
| 前端 | http://10.212.227.125:3000 | 🟢 运行中 | HTTP |
| 后端 | http://10.212.227.125:8000 | 🟢 运行中 | HTTP |
| 后端健康检查 | http://10.212.227.125:8000/health | 🟢 正常 | JSON |
| 音色API | http://10.212.227.125:8000/voices/ | 🟢 137个音色 | JSON |

---

## 🚀 快速开始

1. 打开浏览器
2. 访问: `http://10.212.227.125:3000`
3. 点击底部 "Change Voice" 按钮选择音色
4. 输入文字
5. 点击发送生成语音

**就这么简单！**

---

最后更新: 2025-12-07

